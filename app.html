<!DOCTYPE html>
<html lang="mn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AMT - –£—Ö–∞–∞–ª–∞–≥ –ñ–æ—Ä</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #F8F9FB; --text: #1F2937; --sub-text: #6B7280; --accent: #FF4500;
            --accent-grad: linear-gradient(135deg, #FF4500 0%, #FF8C00 100%);
            --border: #E5E7EB; --input-bg: #FFFFFF; --surface: #FFFFFF; --radius: 20px;
            --font: 'Inter', sans-serif; --font-head: 'Playfair Display', serif;
            --shadow: 0 10px 40px -10px rgba(0,0,0,0.08); --glass: blur(14px);
        }
        [data-theme="dark"] {
            --bg: #0F1115; --text: #F3F4F6; --sub-text: #9CA3AF; --accent: #FF5722;
            --accent-grad: linear-gradient(135deg, #FF5722 0%, #FF9800 100%);
            --border: #2D3748; --input-bg: #1A202C; --surface: #1A202C; --shadow: none;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg); color: var(--text); font-family: var(--font); min-height: 100vh; overflow-x: hidden; transition: background 0.3s, color 0.3s; padding-bottom: 140px; }
        
        .hidden { display: none !important; }

        header { padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; position: fixed; top: 0; left: 0; width: 100%; z-index: 100; background: rgba(255, 255, 255, 0.05); backdrop-filter: var(--glass); border-bottom: 1px solid var(--border); }
        [data-theme="dark"] header { background: rgba(15, 17, 21, 0.7); }
        .logo-group { cursor: pointer; display: flex; flex-direction: column; text-decoration: none; color: inherit; line-height: 1; }
        .logo { font-family: var(--font-head); font-weight: 900; font-size: 1.8rem; letter-spacing: -1px; background: var(--accent-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .logo-sub { font-family: var(--font); font-size: 0.6rem; font-weight: 800; text-transform: uppercase; letter-spacing: 2px; margin-top: 4px; opacity: 0.8; }
        .icon-btn { width: 40px; height: 40px; border-radius: 50%; background: var(--surface); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 1.2rem; cursor: pointer; color: var(--text); transition: 0.3s; box-shadow: var(--shadow); }
        
        main { 
    display: flex; flex-direction: column; align-items: center; 
    width: 100%; max-width: 700px; margin: 100px auto 0 auto; 
    padding: 0 20px 120px 20px; /* Added 120px bottom padding */
}
        .hero { text-align: center; margin-bottom: 35px; width: 100%; }
        .hero h1 { font-family: var(--font-head); font-size: 2.5rem; margin-bottom: 10px; font-weight: 900; }
        .input-wrapper { position: relative; margin-bottom: 20px; width: 100%; }
        .main-input { width: 100%; padding: 22px 25px; border-radius: 25px; background: var(--input-bg); border: 2px solid var(--border); font-size: 1.2rem; color: var(--text); outline: none; transition: 0.3s; box-shadow: var(--shadow); }
        .main-input:focus { border-color: var(--accent); }
        .tags-area { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 30px; min-height: 40px; width: 100%; }
        .tag { background: var(--surface); border: 1px solid var(--border); padding: 10px 20px; border-radius: 50px; font-weight: 600; color: var(--text); cursor: default; display: flex; align-items: center; gap: 8px; animation: pop 0.3s ease; }
        .section-label { font-size: 0.8rem; font-weight: 800; color: var(--sub-text); text-transform: uppercase; letter-spacing: 1px; margin: 30px 0 12px 0; display: block; width: 100%; }
        
        .style-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; width: 100%; }
        .style-chip { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 15px 10px; text-align: center; cursor: pointer; transition: 0.2s; display: flex; flex-direction: column; gap: 5px; align-items: center; }
        .style-chip.selected { background: var(--text); color: var(--bg); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
        .level-bar { 
    display: grid; /* Uses Grid for perfect alignment */
    grid-template-columns: repeat(5, 1fr); /* Creates 5 equal columns */
    gap: 4px; /* Small gap between items */
    background: var(--surface); 
    padding: 6px; 
    border-radius: 20px; 
    border: 1px solid var(--border); 
    width: 100%; 
}
.lvl-step { 
    text-align: center; 
    padding: 10px 4px; /* Adjusted padding */
    border-radius: 14px; 
    cursor: pointer; 
    transition: 0.3s; 
    color: var(--sub-text); 
    display: flex; 
    flex-direction: column; /* Stack emoji and text */
    align-items: center; 
    justify-content: center;
    user-select: none;        
    .lvl-step.active { background: var(--text); color: var(--bg); box-shadow: 0 4px 15px rgba(0,0,0,0.15); }
    .lvl-step.active { 
    background: var(--text); 
    color: var(--bg); 
    box-shadow: 0 4px 15px rgba(0,0,0,0.15); 
}   
    .level-desc { text-align: center; font-size: 0.9rem; color: var(--accent); margin-top: 10px; font-weight: 600; font-style: italic; min-height: 24px; width: 100%; }
        .pantry-box { background: var(--surface); border: 1px solid var(--border); border-radius: 20px; padding: 25px; margin-top: 15px; width: 100%; }
        .pantry-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .pantry-title { font-weight: 700; font-size: 1rem; }
        .switch { position: relative; display: inline-block; width: 48px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--border); transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(22px); }
        .pantry-chips-grid { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; transition: 0.3s; }
        .pantry-content.disabled .pantry-chips-grid { opacity: 0.3; pointer-events: none; }
        .p-chip { padding: 8px 14px; background: var(--bg); border: 1px solid var(--border); border-radius: 12px; font-size: 0.85rem; font-weight: 600; color: var(--sub-text); cursor: pointer; transition: 0.2s; user-select: none; }
        .p-chip.active { background: var(--accent-grad); color: white; border: none; }
        .dietary-section { width: 100%; margin-bottom: 30px; }
        .filters { display: flex; flex-wrap: wrap; gap: 10px; width: 100%; margin-top: 10px; }
        .filter-chip { padding: 10px 18px; border-radius: 14px; background: var(--input-bg); color: var(--sub-text); font-size: 0.9rem; cursor: pointer; border: 1px solid var(--border); transition: 0.2s; font-weight: 600; }
        .filter-chip.selected { background: var(--text); color: var(--bg); border-color: var(--text); }
        .custom-diet-input { border: 1px dashed var(--sub-text); background: transparent; color: var(--text); padding: 10px 16px; border-radius: 14px; font-family: var(--font); font-size: 0.9rem; outline: none; width: 100px; transition: 0.3s; }
        .custom-diet-input:focus { width: 140px; border-color: var(--accent); border-style: solid; }
        .calc-box { background: var(--surface); border: 1px solid var(--border); border-radius: 20px; padding: 20px 25px; margin-top: 30px; display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .counter { display: flex; align-items: center; gap: 15px; }
        .count-btn { width: 35px; height: 35px; border-radius: 50%; background: var(--bg); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 1.2rem; cursor: pointer; color: var(--text); }
        .tips-box { margin-top: 20px; width: 100%; padding: 15px; border-radius: 16px; background: linear-gradient(135deg, #FF4500, #FF8C00); color: white; text-align: center; font-size: 0.95rem; line-height: 1.5; font-style: italic; box-shadow: var(--shadow); }
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; padding: 20px; background: rgba(255,255,255,0.7); backdrop-filter: var(--glass); border-top: 1px solid var(--border); display: flex; justify-content: center; z-index: 900; }
        [data-theme="dark"] .bottom-nav { background: rgba(15, 23, 42, 0.7); }
        .btn-continue { width: 100%; max-width: 600px; height: 65px; border-radius: 35px; background: var(--text); color: var(--bg); border: none; font-size: 1.1rem; font-weight: 800; letter-spacing: 1px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; padding: 0 35px; box-shadow: 0 15px 30px rgba(0,0,0,0.15); transition: 0.3s; }
        .btn-continue:hover { transform: scale(1.02); }
        .btn-continue:disabled { opacity: 0.5; cursor: not-allowed; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); z-index: 1100; opacity: 0; pointer-events: none; transition: 0.3s; display: flex; align-items: center; justify-content: center; }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-card { width: 90%; max-width: 600px; max-height: 85vh; background: var(--bg); border-radius: 24px; padding: 30px; transform: scale(0.9); opacity: 0; transition: 0.3s cubic-bezier(0.16, 1, 0.3, 1); overflow-y: auto; border: 1px solid var(--border); }
        .modal-overlay.active .modal-card { transform: scale(1); opacity: 1; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .modal-title { font-size: 1.4rem; font-weight: 900; }
        .btn-close { width: 40px; height: 40px; border-radius: 50%; background: var(--border); border: none; font-size: 1.5rem; cursor: pointer; color: var(--text); display: flex; align-items: center; justify-content: center; }
        .taste-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 30px; }
        .taste-chip { padding: 18px; border-radius: 16px; background: var(--surface); border: 2px solid var(--border); text-align: center; font-weight: 700; font-size: 0.95rem; cursor: pointer; transition: 0.2s; }
        .taste-chip.selected { background: var(--text); color: var(--bg); border-color: var(--text); }
        .appliance-chips { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 30px; }
        .app-chip { padding: 10px 18px; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; font-weight: 600; cursor: pointer; font-size: 0.9rem; }
        .app-chip.selected { background: var(--text); color: var(--bg); }
        .btn-generate { width: 100%; padding: 22px; border-radius: 18px; border: none; margin-bottom: 12px; font-size: 1.1rem; font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; transition: 0.2s; }
        .btn-gen-gourmet { background: var(--accent); color: white; box-shadow: 0 10px 25px rgba(255, 69, 0, 0.25); }
        .btn-gen-easy { background: var(--surface); color: var(--text); border: 2px solid var(--border); }

        /* --- RESULTS VIEW STYLES --- */
        #view-results, #view-details {
    position: fixed; top: 0; left: 0; width: 100%; 
    height: 100dvh; /* Changed from 100% to 100dvh for mobile browsers */
    background: var(--bg); z-index: 2000; padding: 20px;
    padding-bottom: 100px; /* Added space so content isn't hidden behind the button */
    overflow-y: auto; display: none; flex-direction: column; align-items: center;
    -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
}
            background: var(--bg); z-index: 2000; padding: 80px 20px 20px 20px;
            overflow-y: auto; display: none; flex-direction: column; align-items: center;
        }
        .results-container { max-width: 700px; width: 100%; padding-top: 60px; }
        
        .recipe-card {
            background: var(--surface); border-radius: 24px; padding: 25px; margin-bottom: 25px;
            border: 1px solid var(--border); box-shadow: var(--shadow); animation: pop 0.4s ease-out;
        }
        .recipe-card h3 { font-family: var(--font-head); font-size: 1.5rem; color: var(--accent); margin-bottom: 10px; }
        .recipe-card p { font-size: 0.95rem; line-height: 1.6; color: var(--text); margin-bottom: 15px; }
        
        .btn-select {
            width: 100%; padding: 12px; border-radius: 14px; border: none;
            background: var(--text); color: var(--bg); font-weight: 700; cursor: pointer; transition: 0.2s;
        }
        .btn-select:hover { transform: scale(1.02); background: var(--accent); }

        /* Details View */
        .details-container { max-width: 700px; width: 100%; padding-top: 60px; }
        .details-content { background: var(--surface); padding: 30px; border-radius: 30px; border: 1px solid var(--border); }
        .details-content h2 { color: var(--accent); font-family: var(--font-head); margin-bottom: 20px; font-size: 2rem; }
        .details-content ul, .details-content ol { padding-left: 20px; margin-bottom: 20px; }
        .details-content li { margin-bottom: 10px; line-height: 1.6; }

        #ai-loading-full { text-align: center; margin-top: 100px; }
        .loader { font-size: 3rem; animation: spin 2s infinite linear; display: inline-block; }
        
        .btn-back {
            position: fixed; top: 20px; left: 20px; padding: 10px 20px;
            background: var(--surface); border: 1px solid var(--border); border-radius: 20px;
            cursor: pointer; font-weight: 700; color: var(--text); z-index: 3000;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes pop { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
      /* --- MOBILE OPTIMIZATIONS --- */
@media (max-width: 600px) {
    /* 1. Make Modal a "Bottom Sheet" (Slides up from bottom) */
    .modal-overlay { align-items: flex-end; } /* Align to bottom */
    
    .modal-card {
        width: 100%; 
        max-width: 100%; 
        border-radius: 30px 30px 0 0; /* Round top corners only */
        padding: 30px 25px 50px 25px; /* Extra padding at bottom for iPhone home bar */
        transform: translateY(100%); /* Start hidden below screen */
        border-bottom: none;
    }

    .modal-overlay.active .modal-card { 
        transform: translateY(0); /* Slide up animation */
    }

    /* 2. Bigger Touch Targets for Fingers */
    .style-chip, .p-chip, .app-chip, .tag {
        padding: 12px 18px; /* Larger hit area */
        font-size: 0.95rem;
    }

    .style-grid {
        grid-template-columns: repeat(auto-fill, minmax(30%, 1fr)); /* Bigger items */
    }

    /* 3. Adjust Typography */
    .hero h1 { font-size: 2rem; }
    .result-title { font-size: 1.8rem; margin-top: 10px; }
}
    </style>
</head>
<body>
    <header>
        <a href="index.html" class="logo-group">
            <div class="logo">AMT<span>.</span></div>
            <div class="logo-sub">Action ‚Ä¢ Method ‚Ä¢ Technique</div>
        </a>
        <div class="header-actions">
            <button class="icon-btn" onclick="toggleTheme()">‚óë</button>
        </div>
    </header>

    <main id="main-content">
        <div class="hero">
            <h1>–¢–∞–Ω–¥ —é—É –±–∞–π–Ω–∞?</h1>
            <p>–•”©—Ä–≥”©–≥—á–∏–Ω–¥ –±–∞–π–≥–∞–∞ –æ—Ä—Ü–æ–æ –æ—Ä—É—É–ª–∞–∞–¥, –º—ç—Ä–≥—ç–∂–ª–∏–π–Ω –∂–æ—Ä –∞–≤–∞–∞—Ä–∞–π.</p>
        </div>
        <div class="input-wrapper">
            <input type="text" id="main-input" class="main-input" placeholder="”®–Ω–¥”©–≥, –ú–∞—Ö, –¢”©–º—Å..." onkeypress="handleEnter(event)">
        </div>
        <div class="tags-area" id="tags-area"></div>
        <span class="section-label">üçΩÔ∏è –•–æ–æ–ª–Ω—ã —Ç”©—Ä”©–ª (–î—ç—ç–¥ —Ç–∞–ª –Ω—å 3)</span>
        <div class="style-grid" id="style-grid"></div>
        <span class="section-label">üë®‚Äçüç≥ –•–æ–æ–ª —Ö–∏–π—Ö —á–∞–¥–≤–∞—Ä</span>
        <div class="level-bar">
            <div class="lvl-step" onclick="setLevel(1)" id="lvl-1"><span class="lvl-emoji">üê£</span><span class="lvl-label">–ê–Ω—Ö–∞–Ω</span></div>
            <div class="lvl-step" onclick="setLevel(2)" id="lvl-2"><span class="lvl-emoji">üç≥</span><span class="lvl-label">–°—É—Ä–∞–≥—á</span></div>
            <div class="lvl-step active" onclick="setLevel(3)" id="lvl-3"><span class="lvl-emoji">üç≤</span><span class="lvl-label">–î—É–Ω–¥–∞–∂</span></div>
            <div class="lvl-step" onclick="setLevel(4)" id="lvl-4"><span class="lvl-emoji">üî™</span><span class="lvl-label">–°–∞–π–Ω</span></div>
            <div class="lvl-step" onclick="setLevel(5)" id="lvl-5"><span class="lvl-emoji">üë®‚Äçüç≥</span><span class="lvl-label">Pro</span></div>
        </div>
        <div class="level-desc" id="level-desc">”®–¥”©—Ä —Ç—É—Ç–º—ã–Ω —Ö–æ–æ–ª—ã–≥ —Å–∞–π–Ω —Ö–∏–π–¥—ç–≥.</div>
        <span class="section-label">ü•´ –ì—ç—Ä–∏–π–Ω –Ω”©”©—Ü / –ê–º—Ç–ª–∞–≥—á</span>
        <div class="level-bar" style="margin-bottom:10px;">
            <div class="lvl-step" onclick="setPantryLvl(1)" id="pl-1"><span class="lvl-emoji">üßÇ</span><span class="lvl-label">–¶”©”©–Ω</span></div>
            <div class="lvl-step active" onclick="setPantryLvl(2)" id="pl-2"><span class="lvl-emoji">üßÖ</span><span class="lvl-label">–î—É–Ω–¥–∞–∂</span></div>
            <div class="lvl-step" onclick="setPantryLvl(3)" id="pl-3"><span class="lvl-emoji">ü•´</span><span class="lvl-label">–ò—Ö</span></div>
            <div class="lvl-step" onclick="setPantryLvl(4)" id="pl-4"><span class="lvl-emoji">üå∂Ô∏è</span><span class="lvl-label">–ù—ç–º—ç–ª—Ç</span></div>
            <div class="lvl-step" onclick="setPantryLvl(5)" id="pl-5"><span class="lvl-emoji">üèÜ</span><span class="lvl-label">–ë“Ø—Ä—ç–Ω</span></div>
        </div>
        <div class="pantry-box">
            <div class="pantry-header">
                <span class="pantry-title">–ò–¥—ç–≤—Ö—Ç—ç–π –∞–º—Ç–ª–∞–≥—á—É—É–¥</span>
                <label class="switch">
                    <input type="checkbox" id="pantry-switch" checked onchange="togglePantry()">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="pantry-content" id="pantry-content">
                <p style="font-size:0.8rem; color:var(--sub-text); margin-bottom:10px;">–ë–∞–π—Ö–≥“Ø–π –∑“Ø–π–ª—Å—ç—ç –¥–∞—Ä–∂ –∏–¥—ç–≤—Ö–≥“Ø–π –±–æ–ª–≥–æ–Ω–æ —É—É:</p>
                <div class="pantry-chips-grid" id="pantry-chips-area"></div>
            </div>
        </div>
        <div class="dietary-section">
            <span class="section-label">–•–∞—Ä—à–∏–ª / –¶—ç—ç—Ä</span>
            <div class="filters" id="dietary-filters">
                <div class="filter-chip" onclick="toggleFilter(this, '–°–∞–º–∞—Ä –æ—Ä–æ–æ–≥“Ø–π')">ü•ú –°–∞–º–∞—Ä</div>
                <div class="filter-chip" onclick="toggleFilter(this, '–¶–∞–≤—É—É–ª–∞–≥–≥“Ø–π')">üçû –¶–∞–≤—É—É–ª–∞–≥</div>
                <div class="filter-chip" onclick="toggleFilter(this, '–ì–∞—Ö–∞–π–Ω –º–∞—Ö–≥“Ø–π')">üê∑ –ì–∞—Ö–∞–π–Ω –º–∞—Ö</div>
                <div class="filter-chip" onclick="toggleFilter(this, '–°“Ø“Ø–≥“Ø–π')">ü•õ –°“Ø“Ø</div>
                <div class="filter-chip" onclick="toggleFilter(this, '–°–∞—Ö–∞—Ä–≥“Ø–π')">üç¨ –°–∞—Ö–∞—Ä</div>
                <div class="filter-chip" onclick="toggleFilter(this, '”®–Ω–¥”©–≥–≥“Ø–π')">ü•ö ”®–Ω–¥”©–≥</div>
                <div class="filter-chip" onclick="toggleFilter(this, '–•–∞–ª—É—É–Ω –Ω–æ–≥–æ–æ–≥“Ø–π')">üå∂Ô∏è –•–∞–ª—É—É–Ω –Ω–æ–≥–æ–æ</div>
                <input type="text" class="custom-diet-input" placeholder="+ –ë—É—Å–∞–¥" onkeypress="handleCustomDiet(event)">
            </div>
        </div>
        <div class="calc-box">
            <span class="calc-title">–¢–û–û–¶–û–û–õ–û–õ (–•“Ø–Ω–∏–π —Ç–æ–æ)</span>
            <div class="counter">
                <button class="count-btn" onclick="updServ(-1)">‚àí</button>
                <span class="count-val" id="serv-val">2</span>
                <button class="count-btn" onclick="updServ(1)">+</button>
            </div>
        </div>
        <div class="tips-box" id="daily-tip">–ó”©–≤–ª”©–≥”©”© —É–Ω—à–∏–∂ –±–∞–π–Ω–∞...</div>
    </main>

    <div id="view-results" class="hidden">
        <button class="btn-back" onclick="closeResultsView()">‚Üê –ë—É—Ü–∞—Ö</button>
        <div class="results-container">
            <h2 class="result-title">–¢–∞–Ω—ã –ñ–æ—Ä üë®‚Äçüç≥</h2>
            <div id="ai-loading-full">
                <div class="loader">üç≥</div>
                <p style="color:var(--sub-text); margin-top:15px;">–¢–æ–≥–æ–æ—á –∂–æ—Ä—ã–≥ –±–æ–ª–æ–≤—Å—Ä—É—É–ª–∂ –±–∞–π–Ω–∞...</p>
            </div>
            <div id="ai-result-list"></div>
        </div>
    </div>

    <div id="view-details" class="hidden">
        <button class="btn-back" onclick="closeDetailsView()">‚Üê –ñ–∞–≥—Å–∞–∞–ª—Ç —Ä—É—É</button>
        <div class="details-container">
            <div class="details-content" id="details-content"></div>
        </div>
    </div>

    <div class="bottom-nav">
        <button id="analyze-btn" class="btn-continue" onclick="openSettings()" disabled>
            <span>“Æ–†–ì–≠–õ–ñ–õ“Æ“Æ–õ–≠–•</span>
            <span>‚Üí</span>
        </button>
    </div>

    <div class="modal-overlay" id="modal-overlay" onclick="closeSettings(event)">
        <div class="modal-card" id="settings-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 class="modal-title">–≠—Ü—Å–∏–π–Ω –¢–æ—Ö–∏—Ä–≥–æ–æ</h2>
                <button class="btn-close" onclick="closeSettings()">&times;</button>
            </div>
            <span class="section-label" style="margin-top:0;">–ê–ú–¢–ù–´ –¢”®–†”®–õ (–°–û–ù–ì–û–• - 2 —Ö“Ø—Ä—Ç—ç–ª)</span>
            <div class="taste-grid" id="taste-grid"></div>
            <span class="section-label">–¢”®–•”®”®–†”®–ú–ñ</span>
            <div class="appliance-chips" id="appliance-area"></div>
            <div style="margin-top:30px;">
                <button class="btn-generate btn-gen-gourmet" onclick="callGeminiAPI('gourmet')"><span>‚ú® 5 –¢–∞–Ω—Å–∞–≥ –¶—ç—Å</span></button>
                <button class="btn-generate btn-gen-easy" onclick="callGeminiAPI('easy')"><span>‚ö° 5 –•—É—Ä–¥–∞–Ω –¶—ç—Å</span></button>
            </div>
        </div>
    </div>

    <script>
        const pantryData = [
            ["–î–∞–≤—Å", "–•–∞—Ä –ø–µ—Ä—Ü", "–£—Ä–≥–∞–º–ª—ã–Ω —Ç–æ—Å"], 
            ["–°–æ–Ω–≥–∏–Ω–æ", "–°–∞—Ä–º–∏—Å", "–ì—É—Ä–∏–ª", "–¶–∞–≥–∞–∞–Ω –±—É–¥–∞–∞", "–°–æ—è —Å–æ—É—Å"],
            ["–≠–ª—Å—ç–Ω —á–∏—Ö—ç—Ä", "–£–∫—Å—É—Å", "–õ–∞–≤—Ä—ã–Ω –Ω–∞–≤—á", "–¶”©—Ü–≥–∏–π–Ω —Ç–æ—Å"],
            ["–ö–µ—Ç—á—É–ø", "–ú–∞–π–æ–Ω–µ–∑", "–¢–æ–º–∞—Ç –ø–∞—Å—Ç", "–ì–∏—á", "–°–æ–¥"],
            ["–ì—É—Ä–≤–∞–ª–∂–∏–Ω –±—É–¥–∞–∞", "–ì–æ–π–º–æ–Ω", "–¶–∞—Ä–¥—É—É–ª", "–•—É—É—Ä–∞–π —Å“Ø“Ø", "–ì“Ø–Ω–∂–∏–¥"]
        ];
        const styles = [ {n:"–¢–æ–≥–æ–æ—á", e:"üë®‚Äçüç≥"}, {n:"–ú–æ–Ω–≥–æ–ª", e:"üá≤üá≥"}, {n:"–ê–∑–∏", e:"ü•¢"}, {n:"–ò—Ç–∞–ª–∏", e:"üçù"}, {n:"–§—Ä–∞–Ω—Ü", e:"ü•ê"}, {n:"–ú–µ–∫—Å–∏–∫", e:"üåÆ"}, {n:"–®”©–ª", e:"üç≤"}, {n:"”®–≥–ª”©”©–Ω–∏–π", e:"üç≥"}, {n:"–≠—Ä“Ø“Ø–ª", e:"ü•ó"}, {n:"–¢“Ø—Ä–≥—ç–Ω", e:"üçî"}, {n:"–¶–∞–≥–∞–∞–Ω —Ö–æ–æ–ª", e:"ü•¨"}, {n:"–ê–º—Ç—Ç–∞–Ω", e:"üç∞"} ];
        const tastes = ["–•—ç–≤–∏–π–Ω", "–ó”©”©–ª”©–Ω", "–•–∞–ª—É—É–Ω –Ω–æ–≥–æ–æ—Ç–æ–π", "–ë–∞—è–ª–∞–≥/Umami", "–ß–∏—Ö—ç—Ä–ª—ç–≥", "–ò—Å–≥—ç–ª—ç–Ω"];
        const appliances = ["–ü–ª–µ—Ç–∫–∞", "–®–∞—Ä–∞—Ö —à“Ø“Ø–≥—ç—ç", "Air Fryer", "–ë–∏—Ç“Ø“Ø —á–∞–Ω–∞–≥—á", "–ê–≥—à–∞–∞–≥—á", "–ë–ª–µ–Ω–¥–µ—Ä", "–ì—Ä–∏–ª", "–¢–∞–ª—Ö —à–∞—Ä–∞–≥—á"];
        const lvlDescs = ["–î—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π –∑–∞–∞–≤–∞—Ä —Ö—ç—Ä—ç–≥—Ç—ç–π.", "–≠–Ω–≥–∏–π–Ω —Ö–æ–æ–ª —Ö–∏–π–∂ —á–∞–¥–¥–∞–≥.", "”®–¥”©—Ä —Ç—É—Ç–º—ã–Ω —Ö–æ–æ–ª —Å–∞–π–Ω —Ö–∏–π–¥—ç–≥.", "–ù–∞—Ä–∏–π–Ω –∞–∂–∏–ª–ª–∞–≥–∞–∞—Ç–∞–π —Ö–æ–æ–ª.", "–ú—ç—Ä–≥—ç–∂–ª–∏–π–Ω —Ç“Ø–≤—à–Ω–∏–π –º—ç–¥–ª—ç–≥—Ç—ç–π."];
        const lvlNames = ["–ê–Ω—Ö–∞–Ω", "–°—É—Ä–∞–≥—á", "–î—É–Ω–¥–∞–∂", "–°–∞–π–Ω", "Pro"];
        let state = { ings: [], styles: [], skill: 3, pantryLvl: 2, pantryActiveItems: [], apps: [], diet: [], servings: 2, selectedTastes: ['–•—ç–≤–∏–π–Ω'] };

        window.onload = () => {
            if(localStorage.getItem('theme') === 'dark') document.body.setAttribute('data-theme', 'dark');
            loadPantry(2); renderUI(); randomTip();
        };

        function renderUI() {
            document.getElementById('style-grid').innerHTML = styles.map(s => `<div class="style-chip ${state.styles.includes(s.n) ? 'selected' : ''}" onclick="toggleStyle('${s.n}')"><span class="style-emoji">${s.e}</span><span class="style-name">${s.n}</span></div>`).join('');
            document.getElementById('taste-grid').innerHTML = tastes.map(v => `<div class="taste-chip ${state.selectedTastes.includes(v) ? 'selected' : ''}" onclick="setTaste('${v}')">${v}</div>`).join('');
            document.getElementById('appliance-area').innerHTML = appliances.map(a => `<div class="app-chip ${state.apps.includes(a) ? 'selected' : ''}" onclick="toggleApp('${a}')">${a}</div>`).join('');
        }

        function handleEnter(e) { if(e.key === 'Enter' && e.target.value) { addIng(e.target.value); e.target.value=''; } }
        function addIng(val) { val = val.charAt(0).toUpperCase() + val.slice(1); if(!state.ings.includes(val)) state.ings.push(val); renderTags(); }
        function removeIng(val) { state.ings = state.ings.filter(x => x !== val); renderTags(); }
        function renderTags() {
            document.getElementById('tags-area').innerHTML = state.ings.map(x => `<div class="tag">${x}<span onclick="removeIng('${x}')" style="cursor:pointer;margin-left:5px;">&times;</span></div>`).join('');
            const btn = document.getElementById('analyze-btn');
            if(state.ings.length > 0) { btn.disabled = false; btn.style.opacity = 1; } else { btn.disabled = true; btn.style.opacity = 0.5; }
        }

        function toggleStyle(val) { if(state.styles.includes(val)) state.styles = state.styles.filter(x => x !== val); else if(state.styles.length < 3) state.styles.push(val); renderUI(); }
        function setLevel(l) { state.skill = l; document.querySelectorAll('.level-bar .lvl-step').forEach((el, i) => i+1 === l ? el.classList.add('active') : el.classList.remove('active')); document.getElementById('level-desc').innerText = lvlDescs[l-1]; }
        function setPantryLvl(l) { state.pantryLvl = l; for(let i=1; i<=5; i++) { const el = document.getElementById('pl-'+i); if(i===l) el.classList.add('active'); else el.classList.remove('active'); } loadPantry(l); }
        function loadPantry(lvl) { let items = []; for(let i=0; i<lvl; i++) items = items.concat(pantryData[i]); state.pantryActiveItems = [...new Set(items)]; renderPantryChips(); }
        function renderPantryChips() { document.getElementById('pantry-chips-area').innerHTML = state.pantryActiveItems.map(item => `<div class="p-chip active" onclick="togglePantryItem(this)">${item}</div>`).join(''); }
        function togglePantryItem(el) { el.classList.toggle('active'); }
        function togglePantry() { const on = document.getElementById('pantry-switch').checked; document.getElementById('pantry-content').classList.toggle('disabled', !on); }
        function updServ(n) { state.servings = Math.max(1, state.servings + n); document.getElementById('serv-val').innerText = state.servings; }
        function toggleFilter(el, type) { if(state.diet.includes(type)) { state.diet = state.diet.filter(d => d !== type); el.classList.remove('selected'); } else { state.diet.push(type); el.classList.add('selected'); } }
        function handleCustomDiet(e) { if (e.key === 'Enter' && e.target.value.trim()) { const val = e.target.value.trim(); state.diet.push(val); e.target.value = ''; alert(val + " –Ω—ç–º—ç–≥–¥–ª—ç—ç"); } }
        function toggleApp(val) { state.apps.includes(val) ? state.apps = state.apps.filter(x=>x!==val) : state.apps.push(val); renderUI(); }
        function setTaste(val) { if (state.selectedTastes.includes(val)) state.selectedTastes = state.selectedTastes.filter(t => t !== val); else if (state.selectedTastes.length < 2) state.selectedTastes.push(val); renderUI(); }
        function randomTip() { const tips = ["–ú–∞—Ö–∞–∞ —à–∞—Ä–∞—Ö—ã–Ω ”©–º–Ω”© —Ç–∞—Å–∞–ª–≥–∞–∞–Ω—ã —Ö—ç–º–¥ 20 –º–∏–Ω—É—Ç –±–∞–π–ª–≥–∞–≤–∞–ª —à“Ø“Ø—Å–ª—ç–≥ –±–æ–ª–¥–æ–≥.", "–ì–æ–π–º–æ–Ω —á–∞–Ω–∞—Ö–¥–∞–∞ —É—Å–∞–Ω–¥–∞–∞ –¥–∞–≤—Å —Ö–∞–Ω–≥–∞–ª—Ç—Ç–∞–π —Ö–∏–π–≤—ç–ª –∞–º—Ç –Ω—å –∏–ª“Ø“Ø —Ç–æ–¥–æ—Ä–Ω–æ."]; document.getElementById('daily-tip').innerText = "üí° " + tips[Math.floor(Math.random()*tips.length)]; }
        function toggleTheme() { const d = document.body.getAttribute('data-theme') === 'dark'; document.body.setAttribute('data-theme', d ? 'light' : 'dark'); localStorage.setItem('theme', d ? 'light' : 'dark'); }
        function openSettings() { document.getElementById('modal-overlay').classList.add('active'); document.getElementById('settings-modal').classList.add('active'); }
        function closeSettings(e) { if (e && e.target !== e.currentTarget) return; document.getElementById('modal-overlay').classList.remove('active'); document.getElementById('settings-modal').classList.remove('active'); }

        // --- NEW VIEW LOGIC ---
        function closeResultsView() {
            document.getElementById('view-results').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
            document.querySelector('.bottom-nav').classList.remove('hidden');
            // Hide details view if open
            document.getElementById('view-details').classList.add('hidden');
            document.getElementById('view-details').style.display = 'none';
        }

        function closeDetailsView() {
            document.getElementById('view-details').classList.add('hidden');
            document.getElementById('view-details').style.display = 'none';
            document.getElementById('view-results').classList.remove('hidden');
            document.getElementById('view-results').style.display = 'flex';
        }

        // --- API LOGIC ---
        // --- API KEY ROTATION ---
        const API_KEYS = [
            "AIzaSyD7sgwR6wZ7YZwiUonWWxgb9gazlMC6igI",
            "AIzaSyALF5LcCd2gGWHcCW2cUuTCImB_-Uy-TAs", 
            "AIzaSyBVN0xH90M0sKFa9b95WSXClLZPY7PrsO8"
        ];

        function getActiveKey() {
            return API_KEYS[Math.floor(Math.random() * API_KEYS.length)];
        }

        async function callGeminiAPI(mode) {
            document.getElementById('modal-overlay').classList.remove('active');
            document.getElementById('settings-modal').classList.remove('active');
            document.getElementById('main-content').classList.add('hidden');
            document.querySelector('.bottom-nav').classList.add('hidden');
            
            // Show Results View
            const resView = document.getElementById('view-results');
            resView.classList.remove('hidden');
            resView.style.display = 'flex';
            
            document.getElementById('ai-loading-full').style.display = 'block';
            document.getElementById('ai-result-list').innerHTML = '';

            let activePantry = [];
            if(document.getElementById('pantry-switch').checked) { document.querySelectorAll('.p-chip.active').forEach(c => activePantry.push(c.innerText)); }
            
            const prompt = `Role: Pro Chef (AMT). Language: MONGOLIAN.
            INPUT: Main:${state.ings.join(', ')} Pantry:${activePantry.join(', ')} Cuisine:${state.styles.join(', ')} Skill:${lvlNames[state.skill-1]} Apps:${state.apps.join(', ')} Taste:${state.selectedTastes.join(', ')} Diet:${state.diet.join(', ')}
            TASK: Generate ${mode==='easy'?'5 Quick':'5 Gourmet'} recipes. 
            FORMAT: For each recipe, output this specific HTML structure:
            <div class="recipe-card">
               <h3>Recipe Name</h3>
               <p>Short tasty description.</p>
               <button class="btn-select" onclick="selectRecipe('Recipe Name')">–î—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π “Ø–∑—ç—Ö</button>
            </div>
            Do NOT use markdown.`;
            
            const currentKey = getActiveKey();

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=${currentKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                
                const data = await response.json();
                if (data.candidates && data.candidates[0].content) {
                    const txt = data.candidates[0].content.parts[0].text.replace(/```html/g, '').replace(/```/g, '');
                    document.getElementById('ai-result-list').innerHTML = txt;
                } else {
                    document.getElementById('ai-result-list').innerHTML = `<p style='color:red'>–ê–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞. –î–∞—Ö–∏–Ω –æ—Ä–æ–ª–¥–æ–Ω–æ —É—É.</p>`;
                }
            } catch (err) { 
                document.getElementById('ai-result-list').innerHTML = `<p style='color:red'>–ê–ª–¥–∞–∞: ${err.message}</p>`;
            } 
            finally { document.getElementById('ai-loading-full').style.display = 'none'; }
        }

        async function selectRecipe(recipeName) {
    // 1. –ñ–∞–≥—Å–∞–∞–ª—Ç—ã–≥ –Ω—É—É–∂, –¥—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π —Ö—ç—Å–≥–∏–π–≥ —Ö–∞—Ä—É—É–ª–Ω–∞
    document.getElementById('view-results').classList.add('hidden');
    document.getElementById('view-results').style.display = 'none';
    
    const detView = document.getElementById('view-details');
    detView.classList.remove('hidden');
    detView.style.display = 'flex';
    
    const contentDiv = document.getElementById('details-content');
    contentDiv.innerHTML = `<div id="ai-loading-details" style="display:block;"><div class="loader">üç≥</div><p>${recipeName} –∂–æ—Ä—ã–≥ –±—ç–ª–¥—ç–∂ –±–∞–π–Ω–∞...</p></div>`;

    const prompt = `–ß–∏ –±–æ–ª –º—ç—Ä–≥—ç–∂–ª–∏–π–Ω —Ç–æ–≥–æ–æ—á. "${recipeName}" –Ω—ç—Ä—Ç—ç–π —Ö–æ–æ–ª–Ω—ã –º–∞—à –¥—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π –∂–æ—Ä—ã–≥ MONGOLIAN —Ö—ç–ª—ç—ç—Ä –±–∏—á.
    –ë“Æ–¢–≠–¶:
    <h2>${recipeName}</h2>
    <p>–•–æ–æ–ª–Ω—ã —Ç“Ø“Ø—Ö —ç—Å–≤—ç–ª –æ–Ω—Ü–ª–æ–≥.</p>
    <h4>–û—Ä—Ü:</h4>
    <ul>...</ul>
    <h4>–•–∏–π—Ö –∑–∞–∞–≤–∞—Ä:</h4>
    <ol>... (–ê–ª—Ö–∞–º –±“Ø—Ä–∏–π–≥ —Ç–æ–¥–æ—Ä—Ö–æ–π –±–∏—á)</ol>
    <h4>–¢–æ–≥–æ–æ—á–∏–π–Ω –∑”©–≤–ª”©–≥”©”©:</h4>
    <p>...</p>
    –ó”©–≤—Ö”©–Ω HTML –∞—à–∏–≥–ª–∞. Markdown –±“Ø“Ø –∞—à–∏–≥–ª–∞.`;

    const currentKey = getActiveKey(); // –°–∞–Ω–∞–º—Å–∞—Ä–≥“Ø–π —Ç“Ø–ª—Ö“Ø“Ø—Ä —Å–æ–Ω–≥–æ—Ö

    try {
        // –ß–£–•–ê–õ: –ú–æ–¥–µ–ª–∏–π–Ω –Ω—ç—Ä–∏–π–≥ gemini-3-flash-preview –±–æ–ª–≥–æ–∂ –∑–∞—Å–∞–≤
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=${currentKey}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
        });
        
        const data = await response.json();

        if (data.error) {
            console.error("API Error:", data.error);
            throw new Error(data.error.message);
        }

        if (data.candidates && data.candidates[0].content) {
            const txt = data.candidates[0].content.parts[0].text.replace(/```html/g, '').replace(/```/g, '');
            contentDiv.innerHTML = txt;
        } else {
            throw new Error("AI —Ö–∞—Ä–∏—É –∏—Ä“Ø“Ø–ª—Å—ç–Ω–≥“Ø–π.");
        }
    } catch (err) {
        console.error("Selection Error:", err);
        contentDiv.innerHTML = `
            <div style="text-align:center; padding:20px;">
                <p style="color:red; font-weight:bold;">–£—É—á–ª–∞–∞—Ä–∞–π, –º—ç–¥—ç—ç–ª—ç–ª –∞–≤–∞—Ö–∞–¥ –∞–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞.</p>
                <p style="font-size:0.8rem; color:var(--sub-text); margin-top:10px;">–®–∞–ª—Ç–≥–∞–∞–Ω: ${err.message}</p>
                <button onclick="closeDetailsView()" style="margin-top:15px; padding:10px 20px; border-radius:10px; border:none; background:var(--text); color:var(--bg); cursor:pointer;">–ë—É—Ü–∞—Ö</button>
            </div>`;
    }
}
    </script>
</body>
</html>
