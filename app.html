<!DOCTYPE html>
<html lang="mn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AMT - –£—Ö–∞–∞–ª–∞–≥ –ñ–æ—Ä</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #F8F9FB; --text: #1F2937; --sub-text: #6B7280; --accent: #FF4500;
            --accent-grad: linear-gradient(135deg, #FF4500 0%, #FF8C00 100%);
            --border: #E5E7EB; --input-bg: #FFFFFF; --surface: #FFFFFF; --radius: 20px;
            --font: 'Inter', sans-serif; --font-head: 'Playfair Display', serif;
            --shadow: 0 10px 40px -10px rgba(0,0,0,0.08); --glass: blur(14px);
        }
        [data-theme="dark"] {
            --bg: #0F1115; --text: #F3F4F6; --sub-text: #9CA3AF; --accent: #FF5722;
            --accent-grad: linear-gradient(135deg, #FF5722 0%, #FF9800 100%);
            --border: #2D3748; --input-bg: #1A202C; --surface: #1A202C; --shadow: none;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg); color: var(--text); font-family: var(--font); min-height: 100vh; overflow-x: hidden; transition: background 0.3s, color 0.3s; padding-bottom: 140px; }
        .hidden { display: none !important; }

        header { padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; position: fixed; top: 0; left: 0; width: 100%; z-index: 100; background: rgba(255, 255, 255, 0.05); backdrop-filter: var(--glass); border-bottom: 1px solid var(--border); }
        [data-theme="dark"] header { background: rgba(15, 17, 21, 0.7); }
        .logo-group { cursor: pointer; display: flex; flex-direction: column; text-decoration: none; color: inherit; line-height: 1; }
        .logo { font-family: var(--font-head); font-weight: 900; font-size: 1.8rem; letter-spacing: -1px; background: var(--accent-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .logo-sub { font-family: var(--font); font-size: 0.6rem; font-weight: 800; text-transform: uppercase; letter-spacing: 2px; margin-top: 4px; opacity: 0.8; }
        .icon-btn { width: 40px; height: 40px; border-radius: 50%; background: var(--surface); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 1.2rem; cursor: pointer; color: var(--text); transition: 0.3s; box-shadow: var(--shadow); }
        
        main { display: flex; flex-direction: column; align-items: center; width: 100%; max-width: 700px; margin: 100px auto 0 auto; padding: 0 20px; }
        .hero { text-align: center; margin-bottom: 35px; width: 100%; }
        .hero h1 { font-family: var(--font-head); font-size: 2.5rem; margin-bottom: 10px; font-weight: 900; }
        .input-wrapper { position: relative; margin-bottom: 20px; width: 100%; }
        .main-input { width: 100%; padding: 22px 25px; border-radius: 25px; background: var(--input-bg); border: 2px solid var(--border); font-size: 1.2rem; color: var(--text); outline: none; transition: 0.3s; box-shadow: var(--shadow); }
        .main-input:focus { border-color: var(--accent); }
        
        /* RESULT VIEW & DETAIL VIEW */
        #view-results, #view-details {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg); z-index: 2000; padding: 20px;
            overflow-y: auto; display: none; flex-direction: column; align-items: center;
        }
        .results-container, .details-container { max-width: 700px; width: 100%; padding-top: 80px; padding-bottom: 40px; }
        .result-title { font-family: var(--font-head); font-size: 2rem; margin-bottom: 30px; text-align: center; color: var(--text); }

        /* Recipe Card (List View) */
        .recipe-card {
            background: var(--surface); border-radius: 24px; padding: 25px; margin-bottom: 25px;
            border: 1px solid var(--border); box-shadow: var(--shadow); animation: pop 0.4s ease-out;
        }
        .recipe-card h3 { font-family: var(--font-head); font-size: 1.5rem; color: var(--accent); margin-bottom: 10px; }
        .recipe-card p { font-size: 0.95rem; line-height: 1.6; color: var(--text); margin-bottom: 15px; }
        .btn-select {
            width: 100%; padding: 12px; border-radius: 14px; border: none;
            background: var(--text); color: var(--bg); font-weight: 700; cursor: pointer; transition: 0.2s;
        }
        .btn-select:hover { transform: scale(1.02); background: var(--accent); }

        /* Detail Content (Detail View) */
        .details-content { background: var(--surface); padding: 30px; border-radius: 30px; border: 1px solid var(--border); box-shadow: var(--shadow); animation: pop 0.3s ease-out; }
        .details-content h2 { color: var(--accent); font-family: var(--font-head); margin-bottom: 20px; font-size: 2rem; border-bottom: 2px solid var(--border); padding-bottom: 10px; }
        .details-content h4 { margin-top: 25px; margin-bottom: 10px; font-weight: 800; color: var(--text); text-transform: uppercase; letter-spacing: 1px; }
        .details-content ul, .details-content ol { padding-left: 20px; margin-bottom: 15px; }
        .details-content li { margin-bottom: 8px; line-height: 1.6; color: var(--text); }

        /* Loading */
        #ai-loading-full, #ai-loading-details { text-align: center; margin-top: 100px; display: none; }
        .loader { font-size: 3rem; animation: spin 2s infinite linear; display: inline-block; }
        
        /* Navigation */
        .btn-back {
            position: fixed; top: 20px; left: 20px; padding: 10px 20px;
            background: var(--surface); border: 1px solid var(--border); border-radius: 20px;
            cursor: pointer; font-weight: 700; color: var(--text); z-index: 3000; box-shadow: var(--shadow);
        }

        /* Other UI */
        .tags-area { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 30px; min-height: 40px; width: 100%; }
        .tag { background: var(--surface); border: 1px solid var(--border); padding: 10px 20px; border-radius: 50px; font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .style-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; width: 100%; }
        .style-chip { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 15px 10px; text-align: center; cursor: pointer; transition: 0.2s; }
        .style-chip.selected { background: var(--text); color: var(--bg); }
        .level-bar { display: flex; background: var(--surface); padding: 6px; border-radius: 20px; border: 1px solid var(--border); width: 100%; }
        .lvl-step { flex: 1; text-align: center; padding: 12px; border-radius: 14px; cursor: pointer; }
        .lvl-step.active { background: var(--text); color: var(--bg); }
        .pantry-chips-grid { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .p-chip { padding: 8px 14px; background: var(--bg); border: 1px solid var(--border); border-radius: 12px; font-size: 0.85rem; font-weight: 600; cursor: pointer; }
        .p-chip.active { background: var(--accent-grad); color: white; border: none; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; padding: 20px; background: rgba(255,255,255,0.7); backdrop-filter: var(--glass); border-top: 1px solid var(--border); display: flex; justify-content: center; z-index: 900; }
        .btn-continue { width: 100%; max-width: 600px; height: 65px; border-radius: 35px; background: var(--text); color: var(--bg); border: none; font-size: 1.1rem; font-weight: 800; cursor: pointer; }
        
        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); z-index: 1100; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: 0.3s; }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-card { width: 90%; max-width: 500px; background: var(--bg); border-radius: 24px; padding: 30px; transform: scale(0.9); opacity: 0; transition: 0.3s; border: 1px solid var(--border); }
        .modal-overlay.active .modal-card { transform: scale(1); opacity: 1; }
        .btn-generate { width: 100%; padding: 20px; border-radius: 18px; border: none; margin-bottom: 12px; font-weight: 800; cursor: pointer; display: flex; justify-content: center; gap: 10px; }
        .btn-gen-gourmet { background: var(--accent); color: white; }
        .btn-gen-easy { background: var(--surface); color: var(--text); border: 2px solid var(--border); }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes pop { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>
    <header>
        <div class="logo-group">
            <div class="logo">AMT<span>.</span></div>
            <div class="logo-sub">Action ‚Ä¢ Method ‚Ä¢ Technique</div>
        </div>
        <button class="icon-btn" onclick="toggleTheme()">‚óë</button>
    </header>

    <main id="main-content">
        <div class="hero">
            <h1>–¢–∞–Ω–¥ —é—É –±–∞–π–Ω–∞?</h1>
            <p>–•”©—Ä–≥”©–≥—á–∏–Ω–¥ –±–∞–π–≥–∞–∞ –æ—Ä—Ü–æ–æ –æ—Ä—É—É–ª–∞–∞–¥, –º—ç—Ä–≥—ç–∂–ª–∏–π–Ω –∂–æ—Ä –∞–≤–∞–∞—Ä–∞–π.</p>
        </div>
        <input type="text" id="main-input" class="main-input" placeholder="”®–Ω–¥”©–≥, –ú–∞—Ö, –¢”©–º—Å..." onkeypress="handleEnter(event)">
        <div class="tags-area" id="tags-area"></div>
        <div class="style-grid" id="style-grid" style="margin-top:20px;"></div>
        <div class="level-bar" id="lvl-bar" style="margin-top:20px;"></div>
        <div class="pantry-chips-grid" id="pantry-area" style="margin-top:20px;"></div>
    </main>

    <div id="view-results">
        <button class="btn-back" onclick="location.reload()">‚Üê –ë—É—Ü–∞—Ö</button>
        <div class="results-container">
            <h2 class="result-title">–¢–∞–Ω—ã –ñ–æ—Ä üë®‚Äçüç≥</h2>
            <div id="ai-loading-full">
                <div class="loader">üç≥</div>
                <p>–ñ–æ—Ä –±—ç–ª–¥—ç–∂ –±–∞–π–Ω–∞...</p>
            </div>
            <div id="ai-result-list"></div>
        </div>
    </div>

    <div id="view-details">
        <button class="btn-back" onclick="closeDetailsView()">‚Üê –ñ–∞–≥—Å–∞–∞–ª—Ç —Ä—É—É</button>
        <div class="details-container">
            <div id="ai-loading-details">
                <div class="loader">üî™</div>
                <p>–î—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π –∑–∞–∞–≤—Ä—ã–≥ –±—ç–ª–¥—ç–∂ –±–∞–π–Ω–∞...</p>
            </div>
            <div id="details-content" class="details-content" style="display:none;"></div>
        </div>
    </div>

    <div class="bottom-nav">
        <button id="analyze-btn" class="btn-continue" onclick="openSettings()" disabled>–ñ–û–† “Æ“Æ–°–ì–≠–• ‚Üí</button>
    </div>

    <div class="modal-overlay" id="modal-overlay" onclick="closeSettings(event)">
        <div class="modal-card" id="settings-modal" onclick="event.stopPropagation()">
            <h2 style="margin-bottom:20px;">–¢–æ—Ö–∏—Ä–≥–æ–æ</h2>
            <button class="btn-generate btn-gen-gourmet" onclick="callGeminiAPI('gourmet')">‚ú® 5 –¢–∞–Ω—Å–∞–≥ –¶—ç—Å</button>
            <button class="btn-generate btn-gen-easy" onclick="callGeminiAPI('easy')">‚ö° 5 –•—É—Ä–¥–∞–Ω –¶—ç—Å</button>
        </div>
    </div>

    <script>
        // --- MULTIPLE API KEYS LOGIC ---
        const API_KEYS = [
            "AIzaSyD7sgwR6wZ7YZwiUonWWxgb9gazlMC6igI",
            "AIzaSyALF5LcCd2gGWHcCW2cUuTCImB_-Uy-TAs", 
            "AIzaSyBVN0xH90M0sKFa9b95WSXClLZPY7PrsO8"
        ];

        function getActiveKey() {
            // Pick a random key from the array
            return API_KEYS[Math.floor(Math.random() * API_KEYS.length)];
        }

        // --- APP STATE ---
        let state = { ings: [], styles: [], skill: "–î—É–Ω–¥–∞–∂" };

        window.onload = () => {
            const s = ["üá≤üá≥ –ú–æ–Ω–≥–æ–ª", "ü•¢ –ê–∑–∏", "üçù –ò—Ç–∞–ª–∏", "üç≤ –®”©–ª", "ü•ó –≠—Ä“Ø“Ø–ª"];
            document.getElementById('style-grid').innerHTML = s.map(n => `<div class="style-chip" onclick="this.classList.toggle('selected'); state.styles.push('${n}')">${n}</div>`).join('');
            const p = ["–î–∞–≤—Å", "–•–∞—Ä –ø–µ—Ä—Ü", "–¢–æ—Å", "–°–æ–Ω–≥–∏–Ω–æ", "–°–∞—Ä–º–∏—Å"];
            document.getElementById('pantry-area').innerHTML = p.map(n => `<div class="p-chip active" onclick="this.classList.toggle('active')">${n}</div>`).join('');
            document.getElementById('lvl-bar').innerHTML = ["–ê–Ω—Ö–∞–Ω", "–î—É–Ω–¥–∞–∂", "Pro"].map(n => `<div class="lvl-step ${n==='–î—É–Ω–¥–∞–∂'?'active':''}" onclick="state.skill='${n}'">${n}</div>`).join('');
        };

        function handleEnter(e) { if(e.key === 'Enter' && e.target.value) { state.ings.push(e.target.value); renderTags(); e.target.value=''; } }
        function renderTags() {
            document.getElementById('tags-area').innerHTML = state.ings.map(i => `<div class="tag">${i}</div>`).join('');
            document.getElementById('analyze-btn').disabled = state.ings.length === 0;
        }
        function toggleTheme() { document.body.hasAttribute('data-theme') ? document.body.removeAttribute('data-theme') : document.body.setAttribute('data-theme', 'dark'); }
        function openSettings() { document.getElementById('modal-overlay').classList.add('active'); }
        function closeSettings(e) { if (!e || e.target === e.currentTarget) document.getElementById('modal-overlay').classList.remove('active'); }

        // --- VIEW NAVIGATION ---
        function closeDetailsView() {
            document.getElementById('view-details').style.display = 'none';
            document.getElementById('view-results').style.display = 'flex';
        }

        // --- API STEP 1: GET 5 RECIPES ---
        async function callGeminiAPI(mode) {
            document.getElementById('modal-overlay').classList.remove('active');
            document.getElementById('main-content').classList.add('hidden');
            document.querySelector('.bottom-nav').classList.add('hidden');
            
            const resultView = document.getElementById('view-results');
            resultView.classList.remove('hidden');
            resultView.style.display = 'flex'; // Ensure flex layout
            
            document.getElementById('ai-loading-full').style.display = 'block';
            document.getElementById('ai-result-list').innerHTML = '';

            const prompt = `–ß–∏ –±–æ–ª –º–∞—Å—Ç–µ—Ä —Ç–æ–≥–æ–æ—á. –û—Ä—Ü: ${state.ings.join(', ')}. –¢”©—Ä”©–ª: ${state.styles.join(', ')}. –ß–∞–¥–≤–∞—Ä: ${state.skill}. 
            5 ”©”©—Ä —Ö–æ–æ–ª–Ω—ã —Å–∞–Ω–∞–∞ ”©–≥. –ñ–æ—Ä –±“Ø—Ä–∏–π–≥ –∑–∞–∞–≤–∞–ª –¥–∞—Ä–∞–∞—Ö HTML –±“Ø—Ç—Ü—ç—ç—Ä —Ö–∞—Ä–∏—É–ª:
            <div class="recipe-card">
               <h3>–•–æ–æ–ª–Ω—ã –Ω—ç—Ä</h3>
               <p>–¢–æ–≤—á—Ö–æ–Ω, –∞–º—Ç—Ç–∞–π —Ç–∞–π–ª–±–∞—Ä.</p>
               <button class="btn-select" onclick="selectRecipe('–•–æ–æ–ª–Ω—ã –Ω—ç—Ä')">–î—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π “Ø–∑—ç—Ö</button>
            </div>
            Markdown –±“Ø“Ø –∞—à–∏–≥–ª–∞. –ó”©–≤—Ö”©–Ω —Ü—ç–≤—ç—Ä HTML.`;

            // Use the requested model with KEY ROTATION
            const currentKey = getActiveKey();
            console.log("Using API Key: " + currentKey); // Debugging

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=${currentKey}`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await response.json();
                
                if(data.error) {
                    throw new Error(data.error.message);
                }

                const txt = data.candidates[0].content.parts[0].text.replace(/```html/g, '').replace(/```/g, '');
                document.getElementById('ai-result-list').innerHTML = txt;
            } catch (e) { 
                document.getElementById('ai-result-list').innerHTML = `<p style="color:red; text-align:center;">–ê–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞: ${e.message}<br>”®”©—Ä —Ç“Ø–ª—Ö“Ø“Ø—Ä —Ç—É—Ä—à–∏–∂ –±–∞–π–Ω–∞...</p>`;
            } 
            finally { document.getElementById('ai-loading-full').style.display = 'none'; }
        }

        // --- API STEP 2: GET DETAILS ---
        async function selectRecipe(name) {
            document.getElementById('view-results').style.display = 'none';
            
            const detailView = document.getElementById('view-details');
            detailView.classList.remove('hidden');
            detailView.style.display = 'flex';

            document.getElementById('ai-loading-details').style.display = 'block';
            const contentDiv = document.getElementById('details-content');
            contentDiv.style.display = 'none';
            contentDiv.innerHTML = '';

            const prompt = `–ß–∏ –±–æ–ª –º–∞—Å—Ç–µ—Ä —Ç–æ–≥–æ–æ—á. "${name}" —Ö–æ–æ–ª–Ω—ã –º–∞—à –¥—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π –∂–æ—Ä—ã–≥ MONGOLIAN —Ö—ç–ª—ç—ç—Ä –±–∏—á.
            –ë“Æ–¢–≠–¶: <h2>${name}</h2> <p>–•–æ–æ–ª–Ω—ã –æ–Ω—Ü–ª–æ–≥.</p> <h4>–û—Ä—Ü—É—É–¥:</h4> <ul>...</ul> <h4>–ó–∞–∞–≤–∞—Ä:</h4> <ol>... (–º–∞—à –Ω–∞—Ä–∏–π–Ω –±–∏—á)</ol> <h4>–¢–æ–≥–æ–æ—á–∏–π–Ω –∑”©–≤–ª”©–≥”©”©:</h4> <p>...</p>
            –ó”©–≤—Ö”©–Ω HTML –∞—à–∏–≥–ª–∞.`;

            const currentKey = getActiveKey();

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=${currentKey}`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await response.json();
                
                if(data.error) throw new Error(data.error.message);

                const txt = data.candidates[0].content.parts[0].text.replace(/```html/g, '').replace(/```/g, '');
                contentDiv.innerHTML = txt;
                contentDiv.style.display = 'block';
            } catch (e) { 
                contentDiv.style.display = 'block';
                contentDiv.innerHTML = `<p style="color:red;">–ê–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞: ${e.message}</p>`; 
            }
            finally { document.getElementById('ai-loading-details').style.display = 'none'; }
        }
    </script>
</body>
</html>
